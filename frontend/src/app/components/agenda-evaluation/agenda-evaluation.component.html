<div class="card">
  <div class="card-header">
    <h3><i class="fas fa-calendar-alt"></i> Agendamiento de evaluaciones</h3>
    <hr>
    <div class="form-group row">
      
      <div class="col-sm-10">
        <!--
          <div class="input-group flex-nowrap">
          <div class="input-group-prepend">
            <span class="input-group-text" id="addon-wrapping">
              <i class="fas fa-user-md"></i>
            </span>
          </div>
          <select [(ngModel)]="id" (change)="ngOnInit()" class="custom-select" name="dlKine">
            <option disabled selected>-- Selecciona Kinesiologo --</option>
            <option value="{{row.kine[0]._id}}" *ngFor="let row of kines">
              {{row.kine[0].firstName}} {{row.kine[0].middleName}} {{row.kine[0].lastName}}
              {{row.kine[0].middleLastName}} - {{row.specialization[0].description}}
            </option>
          </select>
        </div>
        -->
        <mat-form-field appearance="outline" >
          <mat-label>Seleccione profesional</mat-label>
          <mat-select (selectionChange)="ngOnInit()"  [errorStateMatcher]="matcher"
          [(ngModel)]="id" name="dlKine">
            <mat-option *ngFor="let row of kines" [value]="row.kine[0]._id">
              {{row.kine[0].firstName}} {{row.kine[0].middleName}} {{row.kine[0].lastName}}
              {{row.kine[0].middleLastName}} - {{row.specialization[0].description}}
            </mat-option>
          </mat-select>
        </mat-form-field>
      </div>

    </div>
  </div>
  <div class="card-body">
    <full-calendar [plugins]="calendarPlugins" [locales]="locales" locale="es" [events]="calendarEvents"
      defaultView="dayGridMonth" (eventClick)="eventClick($event)" (dateClick)="dateClick($event)">
    </full-calendar>
  </div>
</div>


<!-- DATE CLICK MODAL -->
<div class="backdrop" [ngStyle]="{'display':dateModal}"></div>
<div class="modal animated fadeInDown" [ngStyle]="{'display':dateModal}" id="exampleModalScrollable" tabindex="-1"
  role="dialog" aria-labelledby="exampleModalScrollableTitle" aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalCenterTitle"><i class="far fa-bookmark"></i> Agenda del día
          {{dateClicked}}</h5>
        <button type="button" class="close" (click)="closeDateModal()" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form id="eventForm" (submit)="onSubmit()">
          <div class="form-group">
            <!--
            <div class="list-group">
              <a  class="list-group-item"><h6>Pacientes del día:</h6></a>
              <a *ngFor="let row of dayEvents" href="#" class="list-group-item list-group-item-action list-group-item-warning">
                {{row.patient[0].firstName}} {{row.patient[0].lastName}} {{row.patient[0].middleLastName}}</a>
                <a *ngIf="dayEvents.length<1" (click)="getAgendaHour('T17:00:00')" class="list-group-item list-group-item-action"><h6>Bloque 1</h6></a>
                <a *ngIf="dayEvents.length<2" (click)="getAgendaHour('T18:00:00')" class="list-group-item list-group-item-action"><h6>Bloque 2</h6></a>
                <a *ngIf="dayEvents.length<3" (click)="getAgendaHour('T19:00:00')" class="list-group-item list-group-item-action"><h6>Bloque 3</h6></a>
            </div> -->
            <div class="list-group" style="width: auto;" id="list-tab" role="tablist">
              <a class="list-group-item list-group-item-dark" aria-controls="home">
                <h6>Pacientes del día:</h6>
              </a>
              <a *ngFor="let row of dayEvents" class="list-group-item list-group-item-action list-group-item-warning"
                id="list-profile-list" data-toggle="list" href="#" role="tab" aria-controls="profile">
                <strong>{{row.patient[0].firstName}} {{row.patient[0].lastName}} {{row.patient[0].middleLastName}}</strong></a>
              <a *ngIf="dayEvents.length<1" (click)="getAgendaHour('T17:00:00')"
                class="list-group-item list-group-item-action" href="#" data-toggle="list" role="tab">
                <h6>Bloque 1 - 17:00 hrs</h6>
              </a>
              <a *ngIf="dayEvents.length<2" (click)="getAgendaHour('T18:00:00')"
                class="list-group-item list-group-item-action" href="#" data-toggle="list" role="tab">
                <h6>Bloque 2 - 18:00 hrs</h6>
              </a>
              <a *ngIf="dayEvents.length<3" (click)="getAgendaHour('T19:00:00')"
                class="list-group-item list-group-item-action" href="#" data-toggle="list" role="tab">
                <h6>Bloque 3 - 19:00 hrs</h6>
              </a>
            </div>
          </div>
          <hr>
          <h4>Agendar paciente</h4>
          <div class="form-group pt-2">
            <div class="row justify-content-md-center">
              <div class="col-md-auto">
                <div class="list-group list-group-horizontal">
                  <button (click)="setGender('Masculino')" class="text-center list-group-item list-group-item-action" data-toggle="list" role="tab">
                      <i class="fas fa-mars fa-3x"></i>
                  </button>
                  <button (click)="setGender('Femenino')" class="text-center list-group-item list-group-item-action" data-toggle="list" role="tab">
                      <i class="fas fa-venus fa-3x"></i>
                  </button>
              </div>
              </div>
            </div>
          </div>
          <div class="form-group">
            <div class="row">
              <div class="col">
                <!--
                  <div class="input-group flex-nowrap">
                  <div class="input-group-prepend">
                    <span class="input-group-text" id="addon-wrapping">
                      <i class="fas fa-key"></i>
                    </span>
                  </div>
                  <input [(ngModel)]="user.rut" name="rut" type="text" class="form-control" placeholder="Rut"
                    aria-label="rut" aria-describedby="addon-wrapping">
                </div>
                -->
                <mat-form-field appearance="outline">
                  <mat-label>Rut</mat-label>
                  <input type="text" maxlength="15" matInput [formControl]="rutFormControl"
                    [errorStateMatcher]="matcher" placeholder="Rut" [(ngModel)]="user.rut" name="rut">
                  <mat-icon matSuffix><i class="fas fa-fingerprint"></i></mat-icon>
                  <mat-error *ngIf="rutFormControl.hasError('required')">
                    Rut es <strong>requerido</strong>
                  </mat-error>
                </mat-form-field>
              </div>
              <div class="col">
                <!--
                  <select [(ngModel)]="patient_data.prevition" name="dlPrevition" class="form-control">
                  <option disabled selected>-- Previsión--</option>
                  <option *ngFor="let option of previtions">{{option}}</option>
                </select>
                -->
                <mat-form-field appearance="outline" >
                  <mat-label>Previsión</mat-label>
                  <mat-select style="z-index: 9999;" [formControl]="previtionFormControl" [errorStateMatcher]="matcher"
                  [(ngModel)]="patient_data.prevition" name="dlPrevition">
                    <mat-option style="z-index: 9999;" disabled>- Seleccione -</mat-option>
                    <mat-option style="z-index: 9999;" *ngFor="let option of previtions" [value]="option">
                      {{option}}
                    </mat-option>
                  </mat-select>
                  <mat-error *ngIf="previtionFormControl.hasError('required')">
                    Previsión es <strong>requerida</strong>
                  </mat-error>
                </mat-form-field>
              </div>
            </div>
          </div>
          <div class="form-group">
            <div class="row">
              <div class="col">
                <!--
                  <div class="input-group flex-nowrap">
                  <div class="input-group-prepend">
                    <span class="input-group-text" id="addon-wrapping">
                      <i class="fas fa-key"></i>
                    </span>
                  </div>
                  <input [(ngModel)]="user.firstName" name="name" type="text" class="form-control" placeholder="Nombre"
                    aria-label="nombre" aria-describedby="addon-wrapping">
                </div>
                -->
                <mat-form-field appearance="outline">
                  <mat-label>Nombre</mat-label>
                  <input type="text" maxlength="15" matInput [formControl]="firstNameFormControl"
                    [errorStateMatcher]="matcher" placeholder="Ex. John" [(ngModel)]="user.firstName" name="name">
                  <mat-icon matSuffix><i class="fas fa-user"></i></mat-icon>
                  <mat-error *ngIf="firstNameFormControl.hasError('required')">
                    Nombre es <strong>requerido</strong>
                  </mat-error>
                </mat-form-field>
              </div>
              <div class="col">
                <!--
                  <div class="input-group flex-nowrap">
                  <div class="input-group-prepend">
                    <span class="input-group-text" id="addon-wrapping">
                      <i class="fas fa-key"></i>
                    </span>
                  </div>
                  <input [(ngModel)]="user.middleName" name="middleName" type="text" class="form-control"
                    placeholder="Seg. nombre" aria-label="middleName" aria-describedby="addon-wrapping">
                </div>
                -->
                <mat-form-field appearance="outline">
                  <mat-label>Segundo nombre</mat-label>
                  <input type="text" maxlength="15" matInput [formControl]="middleNameFormControl"
                    [errorStateMatcher]="matcher" placeholder="Ex. Peter" [(ngModel)]="user.middleName" name="middleName">
                  <mat-icon matSuffix><i class="fas fa-user"></i></mat-icon>
                  <mat-error *ngIf="middleNameFormControl.hasError('required')">
                    Segundo nombre es <strong>requerido</strong>
                  </mat-error>
                </mat-form-field>
              </div>
            </div>

          </div>
          <div class="form-group">
            <div class="row">
              <div class="col">
                <!--
                  <div class="input-group flex-nowrap">
                  <div class="input-group-prepend">
                    <span class="input-group-text" id="addon-wrapping">
                      <i class="fas fa-key"></i>
                    </span>
                  </div>
                  <input [(ngModel)]="user.lastName" name="lastName" type="text" class="form-control"
                    placeholder="A. Paterno" aria-label="lastName" aria-describedby="addon-wrapping">
                </div>
                -->
                <mat-form-field appearance="outline">
                  <mat-label>Apellido paterno</mat-label>
                  <input type="text" maxlength="15" matInput [formControl]="lastNameFormControl"
                    [errorStateMatcher]="matcher" placeholder="Ex. Caceres" [(ngModel)]="user.lastName" name="lastName">
                  <mat-icon matSuffix><i class="fas fa-user"></i></mat-icon>
                  <mat-error *ngIf="lastNameFormControl.hasError('required')">
                    Apellido paterno es <strong>requerido</strong>
                  </mat-error>
                </mat-form-field>
              </div>
              <div class="col">
                <!--
                  <div class="input-group flex-nowrap">
                  <div class="input-group-prepend">
                    <span class="input-group-text" id="addon-wrapping">
                      <i class="fas fa-key"></i>
                    </span>
                  </div>
                  <input [(ngModel)]="user.middleLastName" name="middleLastName" type="text" class="form-control"
                    placeholder="A. Materno" aria-label="middleLastName" aria-describedby="addon-wrapping">
                </div>
                -->
                <mat-form-field appearance="outline">
                  <mat-label>Apellido materno</mat-label>
                  <input type="text" maxlength="15" matInput [formControl]="middleLastNameFormControl"
                    [errorStateMatcher]="matcher" placeholder="Apellido materno" [(ngModel)]="user.middleLastName" name="middleLastName">
                  <mat-icon matSuffix><i class="fas fa-user"></i></mat-icon>
                  <mat-error *ngIf="middleLastNameFormControl.hasError('required')">
                    Apellido materno es <strong>requerido</strong>
                  </mat-error>
                </mat-form-field>
              </div>
            </div>
          </div>
          <div class="form-group">
            <div class="row">
              <div class="col">
                <mat-form-field appearance="outline">
                  <mat-label>Edad</mat-label>
                  <input type="text" maxlength="2" matInput [formControl]="ageFormControl"
                    [errorStateMatcher]="matcher" placeholder="Edad" [(ngModel)]="user.age" name="age">
                  <mat-icon matSuffix><i class="fas fa-user"></i></mat-icon>
                  <mat-error *ngIf="ageFormControl.hasError('required')">
                    Edad es <strong>requerida</strong>
                  </mat-error>
                  <mat-error *ngIf="ageFormControl.hasError('pattern')">
                    Porfavor, ingrese una edad <strong>valida</strong>
                  </mat-error>
                </mat-form-field>
              </div>
              <div class="col">
                <mat-form-field appearance="outline">
                  <mat-label>Teléfono</mat-label>
                  <input type="text" maxlength="15" matInput [formControl]="phoneFormControl"
                    [errorStateMatcher]="matcher" placeholder="Teléfono" [(ngModel)]="user.phone" name="phone">
                  <mat-icon matSuffix><i class="fas fa-user"></i></mat-icon>
                  <mat-error *ngIf="phoneFormControl.hasError('required')">
                    Teléfono es <strong>requerido</strong>
                  </mat-error>
                  <mat-error *ngIf="phoneFormControl.hasError('pattern')">
                    Porfavor, ingrese una número de teléfono <strong>valido</strong>
                  </mat-error>
                </mat-form-field>
              </div>
            </div>
          </div>
          <div class="form-group">
            <mat-form-field appearance="outline">
              <mat-label>E-mail</mat-label>
              <input type="email" maxlength="30" matInput [formControl]="emailFormControl"
                  [errorStateMatcher]="matcher" placeholder="Ex. Soto" [(ngModel)]="user.email"
                  name="email">
              <mat-icon matSuffix><i class="fas fa-at"></i></mat-icon>
              <mat-error
                  *ngIf="emailFormControl.hasError('email') && !emailFormControl.hasError('required')">
                  Porfavor, ingrese un e-mail valido
              </mat-error>
              <mat-error *ngIf="emailFormControl.hasError('required')">
                  E-mail es <strong>requerido</strong>
              </mat-error>
          </mat-form-field>
          </div>
          <div class="form-group">
            <mat-form-field appearance="outline">
              <mat-label>Dirección</mat-label>
              <input type="text" maxlength="70" matInput [formControl]="addressFormControl"
                [errorStateMatcher]="matcher" placeholder="Dirección" [(ngModel)]="user.address" name="address">
              <mat-icon matSuffix><i class="fas fa-user"></i></mat-icon>
              <mat-error *ngIf="addressFormControl.hasError('required')">
                Dirección es <strong>requerida</strong>
              </mat-error>
              
            </mat-form-field>
          </div>
          <div class="form-group">
            <!--
              <div class="input-group flex-nowrap">
              <div class="input-group-prepend">
                <span class="input-group-text" id="addon-wrapping">
                  <i class="fas fa-key"></i>
                </span>
              </div>
              <textarea [(ngModel)]="treatment.diagnostic" name="diagnostic" style="min-width: 85%;"
                class="form-control" rows="2" placeholder="Diagnostico"></textarea>
            </div>
            -->
            <mat-form-field appearance="outline">
              <mat-label>Diagnostico</mat-label>
              <textarea #message maxlength="250" [formControl]="diagnosticFormControl"
              [errorStateMatcher]="matcher" matInput [(ngModel)]="treatment.diagnostic" name="diagnostic"
              rows="4" placeholder="Diagnostico"></textarea>
              <mat-icon matSuffix><i class="fas fa-stethoscope"></i></mat-icon>
              <mat-hint align="end">{{message.value.length}} / 250</mat-hint>
              <mat-error *ngIf="diagnosticFormControl.hasError('required')">
                Diagnostico es <strong>requerido</strong>
              </mat-error>
            </mat-form-field>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="sky btn btn-smoke" data-dismiss="modal" (click)="closeDateModal()"><i
            class="fas fa-arrow-alt-circle-left"></i> Cancelar</button>
        <button type="submit" form="eventForm" class="raise btn btn-smoke"><i class="fas fa-save"></i> Agendar</button>
      </div>
    </div>
  </div>
</div>



<!--ALERT MODAL-->
<div class="backdrop" [ngStyle]="{'display':warningDisplay}"></div>
<div class="modal animated fadeInDown" [ngStyle]="{'display':warningDisplay}" id="warning-modal" tabindex="-1"
  role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-sm modal-dialog-centered">
    <div class="modal-content bg-warning">
      <div class="modal-body text-center">
        <h3 class="mb-15"><i class="fa fa-exclamation-triangle"></i> Precaución</h3>
        <p>Usted esta agendando un paciente nuevo a este profesional. Está seguro de que los datos ingresados están
          correctos?</p>
        <p>Si es así presione continuar. De lo contrario presione cancelar.</p>
        <div class="row">
          <div class="col-6">
            <button type="button" class="smoke btn btn-smoke" (click)="closeWarning()" data-dismiss="modal"><i
                class="fas fa-undo"></i> Cancelar</button>
          </div>
          <div class="col-6">
            <button type="button" class="smoke btn btn-smoke" (click)="addAgenda()" data-dismiss="modal"><i
                class="fas fa-check-circle"></i> Continuar</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- ERROR MODAL -->
<div class="backdrop" [ngStyle]="{'display':errorDisplay}"></div>
<div class="modal animated fadeInDown" [ngStyle]="{'display':errorDisplay}" id="alert-modal" tabindex="-1" role="dialog"
    aria-labelledby="myLargeModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-sm modal-dialog-centered">
        <div class="modal-content bg-danger text-white">
            <div class="modal-body text-center">
                <h3 class="text-white mb-15"><i class="fa fa-exclamation-triangle"></i> Agenda llena</h3>
                <h6>No puedes agendar más de 3 pacientes por día</h6>
                <button type="button" class="smoke btn btn-smoke" (click)="closeAlert()">Ok</button>
            </div>
        </div>
    </div>
</div>